# DNS服务概述

DNS（Domain Name System）域名系统，提供域名与IP地址的解析服务。
DNS：分布式数据库，逻辑的树形结构称为域名空间，各机构使用域名空间创建DNS信息。
树的最大深度127层，每个节点最多存储63字符。（一般到不了）

www.baidu.com.   四层
最后的.代表根域
www    .baidu    .com     .  

* 域和域名

DNS树的每个节点--域，通过这些节点对域名空间进行划分。域名空间的每个域的名字---域名 进行表示。

域名：通常由一个 完全合格域名（FQDN）标识，它能准确表示出其相对域树根的位置，从节点到树根反向书写，并将**每个节点用.分隔**，比如Google的FQDN为google.com

FQDN长度不超过256字节，只能使用大小写字母 数字 - .
. 只能在结尾或域名标志间使用。
域名不区分大小。

* 从最顶层到下层：根域、顶级域、二级域、子域。

* 根域
记录着Internet重要DNS信息，由Internet域名注册机构管理，将域名空间各部分的管理责任分配到各个组织。
全球有13个根（root）域名。

* 顶级域
1.组织域（三个字符）
.com  商业机构
.edu  教育机构
.gov  政府部门
2.地址域（两个字符）
.cn   中国
3.反向域 in-addr.arpa
将IP地址映射到名字（反向查询）

* 区（zone），资源记录
包含了一组存储在DNS服务器上的资源记录。
DNS服务器回答关于自己区中主机的查询，每个区都有自己的授权服务器。

* 主域名与辅助域名服务器

当区的辅助域名服务器启动时，与主控服务器连接并启动一次区传输，辅助服务器定期与主控服务器通信，查看区数据是否改变，启动数据更新传送。

**每个区必须有主服务器**，至少一台辅助服务器，否则如果主服务器崩溃，就无法解析该区的名称。一般主和辅助服务器在不同子网。

辅助服务器优点：容错能力、减少广域链路的通信量、减轻主服务器的负载。

* DNS服务器：运行DNS服务器程序的计算机，储存DNS数据库信息。尝试解析客户机的查询请求。
* DNS缓存：DNS服务器解析客户机请求时，如果本地没有该DNS信息，会询问其它DNS服务器，当其它服务器返回结果时，该服务器会记录在本地缓存中，成为DNS缓存。下一次客户机提交相同请求时，DNS服务器直接用缓存中的DNS信息解析。

* DNS查询方式：递归、迭代查询。

1.递归查询  一次沟通完

DNS服务器收到客户机请求时，必须使用一个准确的查询结果回复客户机。如果DNS服务器没存储信息，就会询问其它服务器，将结果提交客户机。

2.迭代查询

客户机发送查询请求时，DNS服务器不直接回复查询结果，而是告诉客户机另一台DNS服务器地址，客户机再向这条服务器提交请求，依次循环。

总结：一般，从PC客户端到本地DNS服务器属于递归查询，DNS服务器之间属于迭代查询

## DNS域名解析原理

首先浏览器先检查本地hosts文件是否有这个网址映射关系，如果有就调用这个IP地址映射，完成域名解析。
如果没找到则会查找本地DNS解析器缓存，如果查找到则返回。
如果还是没有找到则会查找本地DNS服务器，如果查找到则返回。
最后迭代查询，按根域服务器 ->顶级域,.cn->第二层域，hb.cn ->子域，www.hb.cn的顺序找到IP地址。

具体过程如下：

1. 客户机提出域名解析请求 , 并将该请求发送给本地的域名服务器 ;
2. 当本地的域名服务器收到请求后 , 就先查询本地的缓存 , 如果有该纪录项 , 则本地的域名服务器就直接把查询的结果返回 ;
3. 如果本地的缓存中没有该纪录 , 则本地域名服务器就直接把请求发给根域名服务器 , 然后根域名服务器再返回给本地域名服务器一个所查询域 (根的子域) 的主域名服务器的地址 ;
4. 本地服务器再向上一步返回的域名服务器发送请求 , 然后接受请求的服务器查询自己的缓存 , 如果没有该纪录 , 则返回相关的下级的域名服务器的地址 ;
5. 重复第四步 , 直到找到正确的纪录 ;
6. 本地域名服务器把返回的结果保存到缓存 , 以备下一次使用 , 同时还将结果返回给客户机 ;

* 正向解析与反向解析

正向：域名到IP
反向：IP到域名（作用：为服务器的身份验证）

* **DNS资源记录**
1.SOA资源记录
每个区在区的开始处包含了一个起始授权记录（SOA），定义了域的全局参数，进行整个域的管理设置。**一个区域文件只允许存在唯一的SOA记录。**
2.NS资源记录
域名服务器记录，指定该域名由哪个DNS服务器进行解析。每个区在区根处至少包含一个NS记录。
3.A资源记录
地址资源记录，将FQDN映射到IP地址，可以让DNS服务器解析对应的IP地址。
4.PTR资源记录
指针记录，把IP地址映射到FQDN。**反向查询，通过IP地址，找到域名。**
5.CNAME资源记录
别名记录资源记录，创建特定的FQDN的别名。用户通过CNAME记录来隐藏用户网络的实现细节，使客户机无法知道真正的域名。
6.MX资源记录
邮件交换记录，为DNS域名指定邮件交换服务器。
