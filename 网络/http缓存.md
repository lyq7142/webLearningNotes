# http缓存

* 分类：
根据是否需要重新向服务器发起请求，分为强制和协商缓存。
根据是否可以被单或多个用户使用，分为私有和共享缓存。

浏览器第一次向服务器发起HTTP请求后，服务器会返回请求的资源，并在响应头中添加一些有关缓存的字段。之后浏览器再次请求该资源时，就可以视情况使用强制缓存或协商缓存。

强制缓存：指浏览器直接从本地缓存中获取数据，不与服务器进行交互，200；
协商缓存：指浏览器发送请求到服务器，服务器判断是否可使用本地缓存，如果可以使用则服务器返回304。

* 控制强制缓存的字段有：

Expires。绝对时间，即服务器时间。浏览器检查当前时间，未失效就直接用缓存文件。少用（服务器和浏览器时间可能不同）。
Cache-Control。相对时间，max-age: 100指浏览器收到文件后，缓存在100s内有效。
// 如果二者都有，浏览器优先使用cache-control

* 控制协商(对比)缓存的字段有：

last-modified是第一次请求资源时，服务器返回的字段，表示最后一次更新的时间。下一次浏览器请求资源时就发送if-modified-since字段。服务器用本地Last-modified时间与if-modified-since时间比较，如果不一致则认为缓存已过期并返回新资源给浏览器；如果时间一致则发送304状态码，让浏览器继续使用缓存。
Etag：资源的实体标识（哈希字符串），当资源内容更新时，Etag会改变。服务器会判断Etag是否发生变化，如果变化则返回新资源，否则返回304。

* 强制缓存
强制缓存在缓存数据未失效的情况下（即Cache-Control的max-age没有过期或者Expires的缓存时间没有过期），那么就会直接使用浏览器的缓存数据，不会再向服务器发送任何请求。强制缓存生效时，http状态码为200。这种方式页面的加载速度是最快的，性能也是很好的，但是在这期间，如果服务器端的资源修改了，页面上是拿不到的，因为它不会再向服务器发请求了。 跟强制缓存相关的header头属性有（Pragma/Cache-Control/Expires）， Pragma和Cache-control共存时，Pragma的优先级是比Cache-Control高的。

* 协商缓存
当第一次请求时服务器返回的响应头中没有Cache-Control和Expires或者Cache-Control和Expires过期还或者它的属性设置为no-cache时(即不走强缓存)，那么浏览器第二次请求时就会与服务器进行协商，与服务器端对比判断资源是否进行了修改更新。如果服务器端的资源没有修改，那么就会返回304状态码，告诉浏览器可以使用缓存中的数据，这样就减少了服务器的数据传输压力。如果数据有更新就会返回200状态码，服务器就会返回更新后的资源并且将缓存信息一起返回。跟协商缓存相关的header头属性有（ETag/If-Not-Match 、Last-Modified/If-Modified-Since）请求头和响应头需要成对出现

* 私有缓存（浏览器级缓存）
私有缓存只能用于单独的用户：Cache-Control: Private

* 共享缓存（代理级缓存）
共享缓存可以被多个用户使用: Cache-Control: Public
