# 重绘 回流（重排）

* 回流：reflow
页面中元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档。
* 重绘：repaint
页面中元素只是样式改变，并不影响它在文档流中的位置时，浏览器将新样式赋予元素并重新绘制。

> 回流必将引起重绘，重绘不一定会引起回流。

* 引发回流：
页面首次渲染，浏览器窗口大小改变，元素尺寸、位置等几何属性变化，添加或删除可见DOM元素，获取属性如clientWidth、offsetWidth、scrollWidth、getComputedStyle()等。多次使用这些值时应该缓存。

* 浏览器自身优化：浏览器维护一个队列，把所有会引起回流、重绘的操作放入该队列，等队列中的操作到一定数量或时间间隔，浏览器会flush队列，进行一批处理，这样多次回流重绘变成一次。

## 避免重绘与回流的方法

1.避免频繁操作样式，最好一次性重写style属性，或者将样式定义为class并一次性更改class属性；

```js
// 判断是否是黑色系样式
const theme = isDark ? 'dark' : 'light'
// 根据判断来设置不同的class
ele.setAttribute('className', theme)
```

2.避免频繁操作DOM，尽量使用离线的DOM，比如创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加回文档中；
3.可以先为元素设置display: none，操作结束后再把它显示出来。因为在display: none的元素上进行DOM操作不会引发回流和重绘；
4.避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来；
5.对具有复杂动画的元素使用fixed或absolute，使它脱离文档流，否则会引起父元素及后续元素频繁回流；
6.不要使用table布局；
7.不要在布局信息改变时做查询（会导致渲染队列强制刷新）
