# 异步-宏任务 & 微任务

宏任务：setTimeout,setInterval,Ajax,DOM事件
微任务：Promise async/await
微任务执行时机比宏任务早

## 异步和单线程

JavaScript是单线程语言，js任务需要排队执行，所以需要异步辅助，将任务分为同步和异步任务。

同步：会阻塞程序的执行
异步：不会阻塞程序的执行，场景（定时任务、网络请求、事件绑定）

打开网站时，网页渲染过程就是一堆同步任务；加载图片音频等就是异步任务。
分别进入不同执行场所

![同步异步](img/%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5.png)

同步任务在主线程上排队执行，只有前一个任务执行完毕才能执行后一个任务；异步任务进入任务队列，只有任务队列通知主线程某个异步任务可执行，该任务才会进入主线程执行。异步任务必须指定回调函数，当主线程开始执行异步任务，就是执行对应的回调函数。

* js运行机制（**事件循环**event loop）：
1）所有的同步任务都在主线程上执行，行成一个执行栈。
2）除了主线程之外，还存在一个任务列队，只要异步任务有了运行结果，就在任务列队中植入一个时间标记。
3）主线程完成所有任务(执行栈清空），就会读取任务列队，先执行微任务队列在执行宏任务队列。
4）重复上面三步。

遇到宏任务，先执行宏任务，将宏任务放入任务队列（event queue），然后再执行微任务，将微任务放入微任务队列（micro task queue），但是，这两个queue不是一个queue。当你往外拿的时候先从微任务队列里拿这个回调函数，然后再从宏任务的queue拿宏任务的回调函数。因为，微任务是ES6语法规定的，宏任务是浏览器规定的。
当前执行栈执行完毕时会立刻先处理所有微任务队列中的事件, 然后再去宏任务队列中取出一个事件。同一次事件循环中, 微任务永远在宏任务之前执行。
